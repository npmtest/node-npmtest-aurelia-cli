<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-aurelia-cli/node_modules/aurelia-cli/lib/build/amodro-trace/index.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-aurelia-cli">npmtest-aurelia-cli (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-aurelia-cli/node_modules/aurelia-cli/lib/build/amodro-trace/index.js</span></h1>
    <h2>
        
        Statements: <span class="metric">3.13% <small>(3 / 96)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 74)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 9)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">3.13% <small>(3 / 96)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-aurelia-cli/node_modules/aurelia-cli/lib/build/amodro-trace/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
var Prom = require('./lib/prom'),
    Loader = require('./lib/loader/Loader'),
    specialDepIds = {
      require: true,
      exports: true,
      module: true
    };
&nbsp;
/**
 * Returns the set of nested dependencies for a given module ID in the options.
 * @param  {Object} options the set of options for trace. Possible options:
 * - rootDir: String. The full path to the root of the project to be scanned.
 *   This is usually the top level directory of the project that is served to
 *   the web, and the reference directory for relative baseUrls in an AMD loader
 *   config.
 * - id: String. the module ID to trace.
 * - findNestedDependencies: Boolean. Defaults to false. Normally require([])
 *   calls inside a define()'d module are not traced, as they are usually meant
 *   to be dynamically loaded dependencies and are not static module
 *   dependencies. However, for some tracing cases it is useful to know these
 *   dynamic dependencies. Setting this option to true will do that. It only
 *   captures require([]) calls that use string literals for dependency IDs. It
 *   cannot trace dependency IDs that are variables for JS expressions.
 * - fileRead: Function. A function that synchronously returns the file contents
 *   for the given file path. Allows overriding where file contents come from,
 *   for instance, building up an in-memory map of file names and contents from
 *   a stream. Arguments passed to this function:
 *   function(defaultReadFunction, moduleName, filePath) {}
 *   Where defaultReadFunction is the default read function used. You can call
 *   it with the filePath to get the contents via the normal file methods this
 *   module uses to get file contents.
 * - fileExists: Function. If fileRead is provided, this function should be
 *   provided too. Determines if a file exists for the mechanism that reads
 *   files. A synchronous Boolean answer is expected. Signature is:
 *   function(defaultExistsFunction, moduleName, filePath) {}
 *   Where defaultExistsFunction is the default exists function used by the
 *   internals of this module.
 * - readTransform: Function. A function that is used to transform the contents
 *   of the modules after the contents are read but before they are parsed for
 *   module APIs. The function will receive these arguments:
 *   function(moduleName, filePath, contents), and should synchronously return a
 *   string that will be used as the contents.
 * - includeContents: Boolean. Set to true if the contents of the modules should
 *   be included in the output. The contents will be the contents after the
 *   readTransform function has run, if it is provided.
 * - writeTransform: Function. When contents are added to the result, run
 *   this function to allow transforming the contents. See the write/
 *   directory for example transforms. Setting this option automatically sets
 *   includeContents to be true.
 * - keepLoader: Boolean. Keep the loader instance and pass it in the return
 *   value. This is useful if transforms that depend on the instance's context
 *   will be used to transform the contents, and where writeTransform is not
 *   the right fit.
 * @param  {Object} loaderConfig the requirejs loader config to use for tracing
 * and finding modules.
 * @return {Object} The trace result.
 */
module.exports = <span class="fstat-no" title="function not covered" >function trace(options, loaderConfig) {</span>
<span class="cstat-no" title="statement not covered" >  return new Prom(<span class="fstat-no" title="function not covered" >function(resolve, reject) {</span></span>
    // Validate the options.
<span class="cstat-no" title="statement not covered" >    if (!options.id) {</span>
<span class="cstat-no" title="statement not covered" >      reject(new Error('options must include "id" ' +</span>
                       'to know what module ID to trace'));
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (options.writeTransform) {</span>
<span class="cstat-no" title="statement not covered" >      options.includeContents = true;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    var logger = {</span>
      warnings: [],
      errors: [],
      warn: <span class="fstat-no" title="function not covered" >function(msg) {</span>
<span class="cstat-no" title="statement not covered" >        logger.warnings.push(msg);</span>
      },
      error: <span class="fstat-no" title="function not covered" >function(msg) {</span>
<span class="cstat-no" title="statement not covered" >        logger.errors.push(msg);</span>
      }
    };
<span class="cstat-no" title="statement not covered" >    options.logger = logger;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var loader = new Loader(options);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (loaderConfig) {</span>
<span class="cstat-no" title="statement not covered" >      loader.getContext().configure(loaderConfig);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function onOk() {</span>
<span class="cstat-no" title="statement not covered" >      var context = loader.getContext();</span>
<span class="cstat-no" title="statement not covered" >      var traceCache = context._traceCache || {};</span>
&nbsp;
      // Pull out the list of IDs for this layer as the return value.
<span class="cstat-no" title="statement not covered" >      var paths = context._layer.buildFilePaths,</span>
          idMap = context._layer.buildFileToModule;
&nbsp;
<span class="cstat-no" title="statement not covered" >      var result = paths.map(<span class="fstat-no" title="function not covered" >function(filePath) {</span></span>
<span class="cstat-no" title="statement not covered" >        var id = idMap[filePath];</span>
        // If a loader plugin, try to guess the path instead of use the ID as
        // the filePath.
<span class="cstat-no" title="statement not covered" >        if (id.indexOf('!') !== -1) {</span>
<span class="cstat-no" title="statement not covered" >          var ext, modifiedName, resourcePath,</span>
              map = context.makeModuleMap(id),
              name = map.name;
&nbsp;
<span class="cstat-no" title="statement not covered" >          var lastIndex = name.lastIndexOf('.');</span>
<span class="cstat-no" title="statement not covered" >          if (lastIndex !== -1) {</span>
<span class="cstat-no" title="statement not covered" >            ext = name.substring(lastIndex);</span>
<span class="cstat-no" title="statement not covered" >            modifiedName = name.substring(0, lastIndex);</span>
<span class="cstat-no" title="statement not covered" >            resourcePath = context.nameToUrl(modifiedName, ext, true);</span>
<span class="cstat-no" title="statement not covered" >            if (context.fileExists(id, resourcePath)) {</span>
<span class="cstat-no" title="statement not covered" >              filePath = resourcePath;</span>
            } else {
<span class="cstat-no" title="statement not covered" >              resourcePath = null;</span>
            }
          }
&nbsp;
          // Try to find a path that might correspond to the loader plugin by
          // looking for the following in priority order:
          // * resourceId[.extension]
          // * resourceId
          // * resourceId.pluginId.
<span class="cstat-no" title="statement not covered" >          if (!resourcePath) {</span>
<span class="cstat-no" title="statement not covered" >            resourcePath = context.nameToUrl(name, '', true);</span>
<span class="cstat-no" title="statement not covered" >            if (context.fileExists(id, resourcePath)) {</span>
<span class="cstat-no" title="statement not covered" >              filePath = resourcePath;</span>
            } else {
<span class="cstat-no" title="statement not covered" >              resourcePath = context.nameToUrl(name, '.' + map.prefix, true);</span>
<span class="cstat-no" title="statement not covered" >              if (context.fileExists(id, resourcePath)) {</span>
<span class="cstat-no" title="statement not covered" >                filePath = resourcePath;</span>
              } else {
<span class="cstat-no" title="statement not covered" >                filePath = null;</span>
              }
            }
          }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var item = {</span>
          id: id
        };
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (filePath) {</span>
<span class="cstat-no" title="statement not covered" >          item.path = filePath;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (options.includeContents &amp;&amp; filePath) {</span>
<span class="cstat-no" title="statement not covered" >          var cacheEntry = traceCache[id];</span>
<span class="cstat-no" title="statement not covered" >          if (cacheEntry &amp;&amp; cacheEntry.contents) {</span>
<span class="cstat-no" title="statement not covered" >            item.contents = cacheEntry.contents;</span>
          } else {
<span class="cstat-no" title="statement not covered" >            var contents = context._readTransformedContents[filePath];</span>
<span class="cstat-no" title="statement not covered" >            if (!contents &amp;&amp; context.fileExists(id, filePath)) {</span>
<span class="cstat-no" title="statement not covered" >              contents = context.fileRead(id, filePath) || '';</span>
<span class="cstat-no" title="statement not covered" >              if (options.writeTransform) {</span>
<span class="cstat-no" title="statement not covered" >                contents = options</span>
                           .writeTransform(context, id, filePath, contents);
              }
            }
<span class="cstat-no" title="statement not covered" >            if (contents &amp;&amp; options.writeTransform) {</span>
<span class="cstat-no" title="statement not covered" >              contents = options.writeTransform(context,</span>
                                                id,
                                                filePath,
                                                contents);
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            item.contents = contents;</span>
          }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (filePath) {</span>
<span class="cstat-no" title="statement not covered" >          var inlinedIds = context.urlToDefines[filePath];</span>
<span class="cstat-no" title="statement not covered" >          if (inlinedIds) {</span>
<span class="cstat-no" title="statement not covered" >            var otherIds;</span>
<span class="cstat-no" title="statement not covered" >            inlinedIds.forEach(<span class="fstat-no" title="function not covered" >function(inlinedId) {</span></span>
<span class="cstat-no" title="statement not covered" >              var deps = context.depsForId[inlinedId];</span>
&nbsp;
              // Do not include the special dependency IDs, they do not help
              // in tracing inter-module dependencies, they are meta ones that
              // are always available.
<span class="cstat-no" title="statement not covered" >              if (deps) {</span>
<span class="cstat-no" title="statement not covered" >                deps = deps.filter(<span class="fstat-no" title="function not covered" >function(dep) {</span></span>
<span class="cstat-no" title="statement not covered" >                  return !specialDepIds.hasOwnProperty(dep);</span>
                });
              }
&nbsp;
<span class="cstat-no" title="statement not covered" >              if (inlinedId === id) {</span>
                // Matches main ID for the file, just add to root of the item.
<span class="cstat-no" title="statement not covered" >                if (deps &amp;&amp; deps.length) {</span>
<span class="cstat-no" title="statement not covered" >                  item.deps = deps;</span>
                }
              } else {
                // Another ID in the file, add it to "otherIds".
<span class="cstat-no" title="statement not covered" >                if (!otherIds) {</span>
<span class="cstat-no" title="statement not covered" >                  otherIds = {};</span>
                }
<span class="cstat-no" title="statement not covered" >                var idProps = otherIds[inlinedId] = {};</span>
<span class="cstat-no" title="statement not covered" >                if (deps &amp;&amp; deps.length) {</span>
<span class="cstat-no" title="statement not covered" >                  idProps.deps = deps;</span>
                }
<span class="cstat-no" title="statement not covered" >                var inlinedIdDependents = context.dependentsForId[inlinedId];</span>
<span class="cstat-no" title="statement not covered" >                if (inlinedIdDependents) {</span>
<span class="cstat-no" title="statement not covered" >                  idProps.dependents = inlinedIdDependents;</span>
                }
              }
            });
<span class="cstat-no" title="statement not covered" >            if (otherIds) {</span>
<span class="cstat-no" title="statement not covered" >              item.otherIds = otherIds;</span>
            }
          }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var dependents = context.dependentsForId[id];</span>
<span class="cstat-no" title="statement not covered" >        if (dependents) {</span>
<span class="cstat-no" title="statement not covered" >          item.dependents = dependents;</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return item;</span>
      });
&nbsp;
      // Clean up resources used by this loader instance.
<span class="cstat-no" title="statement not covered" >      if (!options.keepLoader) {</span>
<span class="cstat-no" title="statement not covered" >        loader.discard();</span>
<span class="cstat-no" title="statement not covered" >        loader = null;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      var resolved = {</span>
        traced: result
      };
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (loader) {</span>
<span class="cstat-no" title="statement not covered" >        resolved.loader = loader;</span>
      }
&nbsp;
      // Return logger warnings and errors
<span class="cstat-no" title="statement not covered" >      if (logger.warnings.length) {</span>
<span class="cstat-no" title="statement not covered" >        resolved.warnings = logger.warnings;</span>
      }
<span class="cstat-no" title="statement not covered" >      if (logger.errors.length) {</span>
<span class="cstat-no" title="statement not covered" >        resolved.errors = logger.errors;</span>
      }
      // Remove logger as it was added above. longer term, clone the object
      // to avoid this.
<span class="cstat-no" title="statement not covered" >      delete options.logger;</span>
&nbsp;
      // Used for updating tests when structure changes
      // console.log(JSON.stringify(resolved, null, '  '));
&nbsp;
<span class="cstat-no" title="statement not covered" >      resolve(resolved);</span>
    }
&nbsp;
    // Inform requirejs that we want this function executed when done.
<span class="cstat-no" title="statement not covered" >    onOk.__requireJsBuild = true;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    loader.require([options.id], onOk, <span class="fstat-no" title="function not covered" >function(err) {</span></span>
<span class="cstat-no" title="statement not covered" >      loader.discard();</span>
<span class="cstat-no" title="statement not covered" >      reject(err);</span>
    });
  });
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Sat Apr 22 2017 11:22:23 GMT+0000 (UTC)</div>
</div>
</body>
</html>
